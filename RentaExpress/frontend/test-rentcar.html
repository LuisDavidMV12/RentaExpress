<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RentCar - Test JavaScript</title>
    <style>
        /* Estilos b√°sicos para testing */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .debug {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease-out;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .vehicle-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .vehicle-card:hover {
            transform: translateY(-5px);
        }
        
        .vehicle-image {
            width: 100%;
            height: 200px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 2rem;
        }
        
        .vehicle-info {
            padding: 1.5rem;
        }
        
        .vehicle-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .vehicle-price {
            font-size: 1.5rem;
            color: #3498db;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .vehicle-details {
            color: #666;
            margin-bottom: 1rem;
        }
        
        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-primary:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <h1>Test RentCar JavaScript</h1>
    
    <div class="debug">
        <h3>Estado del JavaScript:</h3>
        <div id="debug-info">Cargando...</div>
    </div>
    
    <div id="alerts-container"></div>
    
    <div class="loading" id="loading" style="display: none;">
        <div class="spinner"></div>
        <p>Cargando veh√≠culos...</p>
    </div>
    
    <div id="vehicles-container">
        <h2>Veh√≠culos Disponibles</h2>
        <div class="vehicles-grid" id="vehicles-grid">
            <!-- Los veh√≠culos aparecer√°n aqu√≠ -->
        </div>
    </div>
    
    <div id="no-results" style="display: none; text-align: center;">
        <h3>No se encontraron veh√≠culos</h3>
        <p>Intenta con otros filtros de b√∫squeda</p>
    </div>

    <script>
        // ========================================
        // JAVASCRIPT SIMPLIFICADO PARA DEBUG
        // ========================================
        
        console.log('üöó Iniciando RentCar JavaScript...');
        
        // Variables globales
        let vehicles = [];
        let currentUser = null;
        const API_BASE = 'http://localhost:8000/api';
        
        // Datos de prueba
        const demoVehicles = [
            {
                id: 1,
                brand: 'Toyota',
                model: 'Corolla',
                year: 2022,
                price_per_day: 45.00,
                available: true,
                description: 'Sed√°n econ√≥mico, perfecto para ciudad',
                image: null
            },
            {
                id: 2,
                brand: 'Honda',
                model: 'Civic',
                year: 2023,
                price_per_day: 50.00,
                available: true,
                description: 'Sed√°n moderno con excelente rendimiento',
                image: null
            },
            {
                id: 3,
                brand: 'Hyundai',
                model: 'Elantra',
                year: 2021,
                price_per_day: 42.00,
                available: true,
                description: 'C√≥modo y confiable para viajes largos',
                image: null
            },
            {
                id: 4,
                brand: 'Nissan',
                model: 'Sentra',
                year: 2022,
                price_per_day: 48.00,
                available: false,
                description: 'Sed√°n elegante con tecnolog√≠a avanzada',
                image: null
            },
            {
                id: 5,
                brand: 'Chevrolet',
                model: 'Cruze',
                year: 2020,
                price_per_day: 40.00,
                available: true,
                description: 'Cl√°sico americano, espacioso y c√≥modo',
                image: null
            },
            {
                id: 6,
                brand: 'Ford',
                model: 'Focus',
                year: 2021,
                price_per_day: 44.00,
                available: true,
                description: 'Compacto deportivo, ideal para j√≥venes',
                image: null
            }
        ];
        
        // ========================================
        // FUNCIONES DE UTILIDAD
        // ========================================
        
        function showAlert(message, type = 'info') {
            console.log(`üì¢ Alert (${type}): ${message}`);
            
            const container = document.getElementById('alerts-container');
            if (!container) {
                console.error('‚ùå No se encontr√≥ contenedor de alertas');
                return;
            }
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; font-size: 1.2rem; cursor: pointer; opacity: 0.7;">
                        ‚úñ
                    </button>
                </div>
            `;
            
            container.appendChild(alertDiv);
            
            // Auto-remove despu√©s de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.style.display = show ? 'block' : 'none';
                console.log(`‚è≥ Loading: ${show ? 'ON' : 'OFF'}`);
            }
        }
        
        function updateDebugInfo(info) {
            const debugDiv = document.getElementById('debug-info');
            if (debugDiv) {
                debugDiv.innerHTML = `
                    <p><strong>Timestamp:</strong> ${new Date().toLocaleTimeString()}</p>
                    <p><strong>Estado:</strong> ${info}</p>
                    <p><strong>Veh√≠culos cargados:</strong> ${vehicles.length}</p>
                    <p><strong>API Base:</strong> ${API_BASE}</p>
                `;
            }
        }
        
        // ========================================
        // FUNCIONES PRINCIPALES
        // ========================================
        
        async function loadVehicles() {
            console.log('üîÑ Cargando veh√≠culos...');
            showLoading(true);
            updateDebugInfo('Cargando veh√≠culos...');
            
            try {
                // Simular delay para mostrar loading
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Intentar cargar del backend primero
                let vehicleData = [];
                let fromBackend = false;
                
                try {
                    console.log('üåê Intentando conectar con backend...');
                    const response = await fetch(`${API_BASE}/vehicles`, {
                        headers: {
                            'Accept': 'application/json',
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        vehicleData = data.success ? (data.vehicles || data.data || []) : [];
                        fromBackend = true;
                        console.log('‚úÖ Datos cargados del backend:', vehicleData.length);
                    } else {
                        console.log('‚ö†Ô∏è Backend respondi√≥ con error:', response.status);
                    }
                } catch (backendError) {
                    console.log('‚ùå Error de conexi√≥n con backend:', backendError.message);
                }
                
                // Si no hay datos del backend, usar datos de prueba
                if (vehicleData.length === 0) {
                    console.log('üé≠ Usando datos de demostraci√≥n');
                    vehicleData = [...demoVehicles];
                    showAlert('Mostrando veh√≠culos de demostraci√≥n', 'warning');
                    updateDebugInfo('Usando datos de demostraci√≥n');
                } else {
                    showAlert(`Cargados ${vehicleData.length} veh√≠culos del servidor`, 'success');
                    updateDebugInfo(`Cargados ${vehicleData.length} veh√≠culos del backend`);
                }
                
                vehicles = vehicleData;
                displayVehicles(vehicles);
                
            } catch (error) {
                console.error('üí• Error cr√≠tico cargando veh√≠culos:', error);
                // En caso de error cr√≠tico, usar datos de prueba
                vehicles = [...demoVehicles];
                displayVehicles(vehicles);
                showAlert('Error de conexi√≥n. Mostrando datos de demostraci√≥n.', 'warning');
                updateDebugInfo('Error - usando datos de respaldo');
            } finally {
                showLoading(false);
            }
        }
        
        function displayVehicles(vehicleList) {
            console.log('üñºÔ∏è Mostrando veh√≠culos:', vehicleList.length);
            
            const grid = document.getElementById('vehicles-grid');
            const noResults = document.getElementById('no-results');
            
            if (!grid) {
                console.error('‚ùå No se encontr√≥ el grid de veh√≠culos');
                return;
            }
            
            if (vehicleList.length === 0) {
                grid.innerHTML = '';
                if (noResults) noResults.style.display = 'block';
                updateDebugInfo('Sin veh√≠culos para mostrar');
                return;
            }
            
            if (noResults) noResults.style.display = 'none';
            
            const vehicleCards = vehicleList.map(vehicle => {
                return `
                    <div class="vehicle-card" data-vehicle-id="${vehicle.id}">
                        <div class="vehicle-image">
                            ${vehicle.image 
                                ? `<img src="${vehicle.image}" alt="${vehicle.brand} ${vehicle.model}" style="width: 100%; height: 100%; object-fit: cover;">`
                                : `üöó`
                            }
                        </div>
                        <div class="vehicle-info">
                            <h3 class="vehicle-title">${vehicle.brand} ${vehicle.model}</h3>
                            <div class="vehicle-price">$${parseFloat(vehicle.price_per_day).toFixed(2)}/d√≠a</div>
                            <div class="vehicle-details">
                                <p><strong>A√±o:</strong> ${vehicle.year}</p>
                                <p><strong>Estado:</strong> ${vehicle.available ? '‚úÖ Disponible' : '‚ùå No disponible'}</p>
                                ${vehicle.description ? `<p><strong>Descripci√≥n:</strong> ${vehicle.description}</p>` : ''}
                            </div>
                            ${vehicle.available 
                                ? `<button class="btn btn-primary" onclick="handleRentClick(${vehicle.id})" 
                                     ${!currentUser ? 'disabled title="Inicia sesi√≥n para rentar"' : ''}>
                                     ${currentUser ? 'Rentar Ahora' : 'Inicia Sesi√≥n para Rentar'}
                                   </button>`
                                : `<button class="btn btn-danger" disabled>No Disponible</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
            
            grid.innerHTML = vehicleCards;
            updateDebugInfo(`Mostrando ${vehicleList.length} veh√≠culos`);
            console.log('‚úÖ Veh√≠culos mostrados correctamente');
        }
        
        function handleRentClick(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (vehicle) {
                if (currentUser) {
                    showAlert(`¬°Intentando rentar ${vehicle.brand} ${vehicle.model}!`, 'info');
                } else {
                    showAlert('Debes iniciar sesi√≥n para rentar un veh√≠culo', 'warning');
                }
            }
        }
        
        // ========================================
        // FUNCIONES DE B√öSQUEDA
        // ========================================
        
        function searchVehicles(filters) {
            console.log('üîç Buscando con filtros:', filters);
            showLoading(true);
            updateDebugInfo('Realizando b√∫squeda...');
            
            setTimeout(() => {
                const results = filterVehiclesLocally(vehicles, filters);
                displayVehicles(results);
                showLoading(false);
                
                if (results.length === 0) {
                    showAlert('No se encontraron veh√≠culos con esos filtros', 'info');
                } else {
                    showAlert(`Se encontraron ${results.length} veh√≠culos`, 'success');
                }
            }, 500);
        }
        
        function filterVehiclesLocally(vehicleList, filters) {
            return vehicleList.filter(vehicle => {
                let matches = true;
                
                if (filters.brand && filters.brand.trim()) {
                    matches = matches && vehicle.brand.toLowerCase().includes(filters.brand.toLowerCase().trim());
                }
                
                if (filters.model && filters.model.trim()) {
                    matches = matches && vehicle.model.toLowerCase().includes(filters.model.toLowerCase().trim());
                }
                
                if (filters.year && filters.year.trim()) {
                    matches = matches && vehicle.year.toString() === filters.year.trim();
                }
                
                if (filters.max_price && filters.max_price.trim()) {
                    const maxPrice = parseFloat(filters.max_price);
                    if (!isNaN(maxPrice)) {
                        matches = matches && parseFloat(vehicle.price_per_day) <= maxPrice;
                    }
                }
                
                return matches;
            });
        }
        
        // ========================================
        // INICIALIZACI√ìN
        // ========================================
        
        // Funci√≥n de inicializaci√≥n principal
        function initializeApp() {
            console.log('üöÄ Inicializando aplicaci√≥n RentCar...');
            updateDebugInfo('Inicializando...');
            
            // Verificar elementos necesarios
            const requiredElements = ['vehicles-grid', 'loading'];
            const missingElements = requiredElements.filter(id => !document.getElementById(id));
            
            if (missingElements.length > 0) {
                console.error('‚ùå Elementos faltantes:', missingElements);
                showAlert(`Error: Elementos faltantes: ${missingElements.join(', ')}`, 'error');
                return;
            }
            
            console.log('‚úÖ Todos los elementos necesarios encontrados');
            
            // Cargar veh√≠culos
            loadVehicles();
            
            // Configurar eventos globales
            setupGlobalEvents();
        }
        
        function setupGlobalEvents() {
            console.log('‚öôÔ∏è Configurando eventos globales...');
            
            // Test buttons for debugging
            const debugDiv = document.getElementById('debug-info');
            if (debugDiv && debugDiv.parentElement) {
                const testButtons = document.createElement('div');
                testButtons.style.marginTop = '10px';
                testButtons.innerHTML = `
                    <button onclick="loadVehicles()" class="btn btn-primary" style="margin: 5px;">
                        üîÑ Recargar Veh√≠culos
                    </button>
                    <button onclick="testSearch()" class="btn btn-primary" style="margin: 5px;">
                        üîç Test B√∫squeda Toyota
                    </button>
                    <button onclick="testPriceFilter()" class="btn btn-primary" style="margin: 5px;">
                        üí∞ Test Filtro Precio
                    </button>
                `;
                debugDiv.parentElement.appendChild(testButtons);
            }
        }
        
        // Funciones de testing
        function testSearch() {
            searchVehicles({ brand: 'Toyota' });
        }
        
        function testPriceFilter() {
            searchVehicles({ max_price: '45' });
        }
        
        // ========================================
        // ARRANQUE DE LA APLICACI√ìN
        // ========================================
        
        // Ejecutar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
        
        // Log adicional para debug
        console.log('Script cargado completamente');
        
        // Exponer funciones globalmente para debugging
        window.RentCarDebug = {
            loadVehicles,
            displayVehicles,
            searchVehicles,
            vehicles: () => vehicles,
            showAlert,
            demoVehicles
        };
        
    </script>
</body>
</html>